<!-- index.html  -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>üìÜ WhatsApp Scheduler</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: #f4f6f8;
        margin: 0;
        padding: 0;
      }
      .container {
        background: white;
        max-width: 700px;
        margin: 40px auto;
        padding: 28px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }
      h2 {
        text-align: center;
        color: #333;
      }
      label {
        font-weight: bold;
        display: block;
        margin: 12px 0 6px;
        color: #444;
      }
      input,
      textarea,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        font-size: 15px;
        box-sizing: border-box;
      }
      textarea {
        resize: vertical;
        min-height: 80px;
      }
      .row {
        display: flex;
        gap: 8px;
        align-items: center;
      }
      .row > * {
        flex: 1;
      }
      button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 12px 16px;
        font-size: 15px;
        border-radius: 8px;
        margin-top: 16px;
        width: 100%;
        cursor: pointer;
      }
      .btn-secondary {
        background-color: #007bff;
      }
      .btn-light {
        background-color: #f1f1f1;
        color: #333;
      }
      #status {
        margin-top: 14px;
        white-space: pre-line;
        color: #333;
        font-weight: 600;
        max-height: 220px;
        overflow-y: auto;
        padding: 10px;
        border-radius: 8px;
        background: #fafafa;
        border: 1px solid #eee;
      }
      canvas {
        display: block;
        margin: 10px auto;
      }
      .controls {
        display: flex;
        gap: 8px;
        margin-top: 10px;
      }
      .checkbox-container {
        margin-top: 10px;
        font-size: 14px;
      }
      .checkbox-container input {
        transform: scale(1.15);
        margin-right: 8px;
      }
      select[multiple] {
        height: 150px;
      }

      /* Full screen loader overlay */
      #fullScreenLoader {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 9999;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 24px;
        font-weight: 600;
        user-select: none;
      }

      /* Spinner animation */
      #fullScreenLoader svg circle {
        stroke-dasharray: 150;
        stroke-dashoffset: 0;
        animation: dash 1.5s linear infinite;
        stroke: #fff;
        stroke-width: 5;
        fill: none;
        stroke-linecap: round;
      }

      @keyframes dash {
        0% {
          stroke-dashoffset: 150;
        }
        100% {
          stroke-dashoffset: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>üìÜ WhatsApp Message Scheduler</h2>

      <label>Mode:</label>
      <select id="mode">
        <option value="contact">Contact</option>
        <option value="group">Group</option>
        <option value="both">Both</option>
      </select>

      <label>Select from CSV Contacts:</label>
      <div class="row">
        <input
          type="text"
          id="searchBox"
          placeholder="üîç Search contacts or groups..."
          oninput="filterContacts()"
        />
        <button
          class="btn-secondary"
          id="refreshBtn"
          onclick="refreshContacts()"
        >
          üîÑ Refresh
        </button>
      </div>

      <select
        id="contactPicker"
        multiple
        size="8"
        onchange="addSelectedContacts()"
      >
        <optgroup label="Contacts" id="contactsGroup"></optgroup>
        <optgroup label="Groups" id="groupsGroup"></optgroup>
      </select>

      <label>Targets (one per line):</label>
      <textarea
        id="target"
        placeholder="üì± 8801XXXXXXXX&#10;üë• Group Name"
      ></textarea>

      <label>Message:</label>
      <textarea
        id="message"
        placeholder="Your scheduled message here..."
      ></textarea>

      <label>Time:</label>
      <input type="time" id="time" />

      <div id="dateSection">
        <label>Date:</label>
        <input type="date" id="date" />
      </div>

      <div class="checkbox-container">
        <input type="checkbox" id="daily" onchange="toggleDateVisibility()" />
        <label for="daily" style="display: inline">Repeat Daily</label>
      </div>

      <button onclick="schedule()">Schedule Message</button>

      <h3 style="text-align: center; margin-top: 18px">
        üîê QR Code (Scan to Log In)
      </h3>
      <canvas id="qrCanvas" width="220" height="220"></canvas>

      <div id="status">Status messages will appear here...</div>
    </div>

    <!-- Full screen loader overlay -->
    <div id="fullScreenLoader">
      üîÑ Refreshing contacts and groups...
      <div style="margin-top: 20px">
        <svg width="60" height="60" viewBox="0 0 50 50">
          <circle cx="25" cy="25" r="20" />
        </svg>
      </div>
    </div>

    <script>
      function toggleDateVisibility() {
        const dateSection = document.getElementById("dateSection");
        const isDaily = document.getElementById("daily").checked;
        dateSection.style.display = isDaily ? "none" : "block";
      }
      // Don't set onload here, let renderer.js handle init!
    </script>

    <script src="renderer.js"></script>
  </body>
</html>
